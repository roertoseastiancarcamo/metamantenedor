name: Keep Metamantenedor Awake

on:
  schedule:
    - cron: "*/2 * * * *"
  workflow_dispatch:


permissions:
  contents: read

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Warm up endpoints
        run: |
          set -e
          urls=(
            "https://metamantenedor.onrender.com/healthz"
            "https://metamantenedor.onrender.com/"
          )
          for url in "${urls[@]}"; do
            echo "Pinging $url"
            # 2 intentos por si hay wake-up lento
            (curl -fsS --max-time 10 "$url" >/dev/null || sleep 5 && curl -fsS --max-time 10 "$url" >/dev/null) \
              && echo "OK: $url" \
              || echo "WARNING: fallo de ping a $url (continuando)"
          done
